---
import Button from "./ui/Button.astro";
import Tag from "./ui/Tag.astro";
import { storyblokEditable } from "@storyblok/astro";

const { blok } = Astro.props;
---

<section {...storyblokEditable(blok)} id="slider-area">
    <div id="slider-tag">
        <div class="tag-wrapper">
            <Tag variant="primary">{blok.category_text}</Tag>
        </div>
    </div>
    
    <div id="slider-heading">
        <div class="heading">{blok.heading}</div>
        <Button variant="tertiary">{blok.button_text}</Button>
    </div>
    
    <div id="slider-content">
        <div class="slider-column">
            <div class="img-container">
                {blok.img_1 && <img src={blok.img_1.filename} alt={blok.img_1.alt}/>}
                <div class="img-text-wrapper">
                    <div class="img-title">{blok.img_1_title}</div>
                    <div class="img-description">{blok.img_1_description}</div>
                </div>
            </div>
        </div>

        <div class="slider-column">
            <div class="img-container">
                {blok.img_2 && <img src={blok.img_2.filename} alt={blok.img_2.alt}/>}
                <div class="img-text-wrapper">
                    <div class="img-title">{blok.img_2_title}</div>
                    <div class="img-description">{blok.img_2_description}</div>
                </div>
            </div>
        </div>

        <div class="slider-column">
            <div class="img-container">
                {blok.img_3 && <img src={blok.img_3.filename} alt={blok.img_3.alt}/>}
                <div class="img-text-wrapper">
                    <div class="img-title">{blok.img_3_title}</div>
                    <div class="img-description">{blok.img_3_description}</div>
                </div>
            </div>
        </div>
    </div>

    <div id="slider-indicator">
        <span class="dot active"></span>
        <span class="dot"></span>
        <span class="dot"></span>
    </div>
</section>

<style>
    /* MAIN AREA */
    #slider-area {
        display: flex;
        flex-direction: column;
        row-gap: 20px;
        width: 100%;
        background-color: #38322B;
        color: white;
        padding-block: 80px; 
        overflow: hidden;
    }

    #slider-tag, #slider-heading {
        padding-inline: clamp(1.25rem, 8vw, 10%);
    }

    .tag-wrapper {
        width: max-content;
    }

    #slider-heading {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        align-items: flex-start;
        gap: 20px;
        margin-bottom: 30px;
    }

    @media screen and (min-width: 1024px) {
        #slider-heading {
            flex-direction: row;
            align-items: center;
        }
    }

    .heading {
        font-family: "PT Sans", sans-serif;
        font-size: clamp(1.5rem, 4vw, 2.2rem);
        font-weight: 400;
        line-height: 1.1;
    }

    /* THE GRID/SLIDER ENGINE */
    #slider-content {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 30px;
        width: 100%;
        padding-inline: clamp(1.25rem, 8vw, 10%);
    }

    @media (max-width: 1024px) {
        #slider-content {
            display: flex;
            flex-wrap: nowrap;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            gap: 20px;
            padding-inline: 15%; /* Peek effect for mobile */
            scrollbar-width: none;
        }
        #slider-content::-webkit-scrollbar { display: none; }
    }

    .slider-column {
        display: flex;
        flex-direction: column;
        scroll-snap-align: center;
        flex-shrink: 0;
        width: 100%;
    }

    @media (max-width: 1024px) {
        .slider-column {
            width: 65vw; /* Smaller mobile image size */
        }
    }

    /* THE IMAGE CONTAINER & GLASS EFFECT */
    .img-container {
        position: relative;
        width: 100%;
        aspect-ratio: 1 / 1;
        overflow: hidden;
        border-radius: 20px;
        background-color: #4a443d;
        cursor: pointer;
    }

    img {
        height: 100%;
        width: 100%;
        object-fit: cover;
        display: block;
        transition: transform 0.6s cubic-bezier(0.33, 1, 0.68, 1);
    }

    .slider-column:hover img {
        transform: scale(1.1);
    }

    /* OVERLAY WRAPPER */
    .img-text-wrapper {
        position: absolute;
        inset: 0;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        padding: 25px;
        box-sizing: border-box;
        
        /* Greyed out / Liquid Glass Effect */
        background: rgba(56, 50, 43, 0.6); 
        backdrop-filter: blur(8px) saturate(140%);
        -webkit-backdrop-filter: blur(8px) saturate(140%);
        
        opacity: 0;
        transition: opacity 0.4s ease;
    }

    @media (min-width: 1024px) {
        .slider-column:hover .img-text-wrapper {
            opacity: 1;
        }
    }

    /* Touch screen fallback: Keep text visible or active on tap */
    @media (max-width: 1024px) {
        .img-text-wrapper {
            opacity: 1;
            background: linear-gradient(transparent 30%, rgba(0,0,0,0.85));
            justify-content: flex-end;
            backdrop-filter: none; /* Better performance on mobile */
        }
    }

    .img-title {
        font-family: "PT Sans Caption", sans-serif;
        font-weight: 600;
        font-size: 1.25rem;
        margin-bottom: 8px;
        transform: translateY(15px);
        transition: transform 0.4s ease;
    }

    .slider-column:hover .img-title {
        transform: translateY(0);
    }

    .img-description {
        font-family: "PT Sans", sans-serif;
        font-size: 0.95rem;
        line-height: 1.4;
        opacity: 0.9;
    }

    /* DOTS */
    #slider-indicator {
        display: flex;
        justify-content: center;
        gap: 12px;
        margin-top: 30px;
    }

    .dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background-color: rgba(255, 255, 255, 0.2);
        transition: all 0.3s ease;
    }

    .dot.active {
        background-color: white;
        transform: scale(1.4);
    }

    @media (min-width: 1024px) {
        #slider-indicator { display: none; }
    }
</style>

<script>
    const slider = document.getElementById('slider-content');
    const dots = document.querySelectorAll('.dot');

    if (slider && dots.length > 0) {
        slider.addEventListener('scroll', () => {
            const scrollLeft = slider.scrollLeft;
            const firstSlide = slider.querySelector('.slider-column') as HTMLElement;
            
            if (firstSlide) {
                const slideWidth = firstSlide.clientWidth + 20; // width + gap
                const index = Math.round(scrollLeft / slideWidth);
                
                dots.forEach((dot, i) => {
                    dot.classList.toggle('active', i === index);
                });
            }
        });
    }
</script>