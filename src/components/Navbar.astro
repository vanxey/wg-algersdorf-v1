---
import { storyblokEditable } from "@storyblok/astro"

const { blok } = Astro.props
---

<div id="navbar" {...storyblokEditable(blok)}>
    <div id="logo-container">
        <div id="logo">
             <img src="src/assets/wg-logo-2.png" alt="logo" height="auto" width="auto"/>
        </div>
    </div>
    
    <nav id="nav-menu">
        <a href="home">Home</a>
        <a href="/wg">Die WG</a>
        <a href="/angebot">Angebot</a>
        <a href="/kontakt">Kontakt</a>
    </nav>

    <div id="burger-menu" aria-label="Toggle Menu">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#000000">
            <path fill-rule="evenodd" d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd"/>
        </svg>
    </div>
</div>

<script>
    // Astro scripts run on the client by default
    const burgerMenu = document.getElementById('burger-menu');
    const navMenu = document.getElementById('nav-menu');

    burgerMenu?.addEventListener('click', () => {
        const isActive = navMenu?.classList.toggle('active');
        // Update ARIA for accessibility
        burgerMenu.setAttribute('aria-expanded', isActive ? 'true' : 'false');
    });

    // Close menu when clicking a link
    const navLinks = document.querySelectorAll('#nav-menu a');
    navLinks.forEach(link => {
        link.addEventListener('click', () => {
            navMenu?.classList.remove('active');
        });
    });
</script>

<style>
    #navbar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 50px;
        height: 88px;
        width: 100%;
        background-color: white;
        font-family: 'Inter', sans-serif;
        font-weight: 700;
        
        position: sticky;
        top: 0;
        /* Highest level safety */
        z-index: 1000; 
        overflow: visible; 
        border-bottom: 1px solid #f0f0f0;
    }

    #logo {
        display: flex;
        height: 70px;
        width: 70px;
    }

    /* Desktop Navigation */
    nav {
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: end;
        column-gap: 30px;
        height: 100%; /* Works for desktop */
    }

    nav a {
        text-decoration: none;
        color: black;
        position: relative;
        transition: color 0.3s ease;
    }

    /* Desktop Underline */
    nav a::after {
        content: '';
        position: absolute;
        width: 0; height: 2px;
        bottom: -5px; left: 50%;
        background: #A38D75;
        transition: 0.3s;
        transform: translateX(-50%);
    }
    nav a:hover::after { width: 100%; }
    nav a:hover { color: #A38D75; }

    #burger-menu { display: none; cursor: pointer; }
    #burger-menu svg { height: 40px; width: 40px; }

    /* --- MOBILE VIEW --- */
    @media screen and (max-width: 640px) {
        #navbar { padding: 0 20px; }
        
        #burger-menu { display: flex; }

        nav {
            position: absolute;
            /* 100% of the #navbar height (88px) */
            top: 100%; 
            left: 0;
            width: 100%;
            background-color: white;
            flex-direction: column;
            
            /* FIX 1: Reset height so it can grow larger than 88px */
            height: auto; 
            padding: 0;
            
            /* FIX 2: Layering */
            z-index: 999; 
            
            /* Animation Logic */
            overflow: hidden;
            max-height: 0; 
            opacity: 0;
            transition: max-height 0.4s ease-in-out, opacity 0.3s ease;
            box-shadow: 0 10px 15px rgba(0,0,0,0.1);
            pointer-events: none;
        }

        nav.active {
            /* FIX 3: Ensure this is large enough for all links */
            max-height: 600px; 
            opacity: 1;
            pointer-events: auto;
        }

        nav a {
            /* FIX 4: Ensure links take up full width and show properly */
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 70px; /* Each link gets its own height */
            padding: 0;
            border-bottom: 1px solid #f0f0f0;
            background-color: white;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        nav.active a {
            opacity: 1;
        }

        nav a::after { display: none !important; }
        
        nav a:last-child {
            border-bottom: none;
        }
    }
</style>
